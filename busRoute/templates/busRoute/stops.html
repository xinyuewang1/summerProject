{% load staticfiles %}
<!DOCTYPE html>
<html lang = "en">
    <head>
        <!-- Meta tags -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
        <link href="{% static 'css/style.css' %}" type="text/css" rel="stylesheet">
        <link href="{% static 'css/jquery.timepicker.css' %}" type="text/css" rel="stylesheet">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
           
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

        <title>Dublin Bus</title>
    </head>
    
    <body>
        <!-- Link to main javaScript file -->
        <script src = "{% static 'script/dbus.js' %}"></script>
        <!-- Google Map js link -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_TopsrUXWcqAxGDfmmbpJzAbZWyVx_s0&callback=myMap" async defer></script>
        <script src = "{% static 'script/jquery.timepicker.min.js' %}"> </script>
        

        <!-- Header with main page title, main navigation bar and team name & Logo -->
        <nav class = "navbar navbar-expand-md bg-light navbar-light ">

            <a class = "navbar-brand" href = "index.html"><h1>Dublin Bus Travel Times</h1></a>
            <button class = "navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="#collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Fares</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tourism</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                </ul>
                
            </div>
            <h2 style = "float:right;">Innovation Station </h2>
            <a class="navbar-brand" href="#">
                    <img src= "{% static 'images/Logo.png' %}" alt = "Innovation Station Logo" style="width:40px;padding-left:10px;">
            </a>
        </nav>

        <div id = "homeCenter" class="container">
            <div class="row">
                <div class="col-sm-8">
                    <div class="col-sm-12 shadow rounded mt-4" style="background-color:rgb(105,143,123);padding:3px;">
                        <div class = "container-fluid">
                            <div class="row">
                                <div class="col nav2 border-right"><a class = "nav-link" id = "trafficButton" onclick="toggleTraffic(this)" href = "#">Traffic</a></div>
                                <div class="col nav2 border-right"><a class = "nav-link" href = "#">Markers</a></div>
                                <div class="col nav2"><a class = "nav-link" href = "#">Bikes</a></div>
                            </div>
                        </div>
                        <div id = "map"></div>
                    </div>
                </div>
                


                <div class="col-sm-4">
                    <div class = "col-sm-12">
                        <div class="col-sm-12 rounded shadow mt-4" style = "background-color:rgb(105,143,123);">
                            <h3>Route Planner</h3>
                        </div>
                    </div>

                    <div class = "col-sm-12">
                        <div class="col-sm-12 rounded shadow mt-3" style = "background-color:rgb(105,143,123);">
                            <div class = "row text-center text-white">
                                <div class = "col-6 nav-justified" style = "background-color: rgb(105,143,123)" id = "stopSearch" onclick="swapSearch()">
                                    <strong>By Stop</strong>
                                </div>
                                <div class = "col-6 text-center" style = "background-color: black;" id = "addSearch" onclick="swapSearch()">
                                    <strong>By Address</strong>
                                </div>
                            </div>
                            <form id = "routePlanner" role = "form" method="POST">
                                {% csrf_token %}
                                <div class = "row mt-2">
                                    
                                    <div class = "j btn-block ml-2 mr-2">From: {{ form.source }}
                                    <!-- <a onclick = "swapDirection()">&#8645</a> --></div>
                                    <div class = "j btn-block ml-2 mr-2">To: &nbsp &nbsp  {{ form.destination }}</div>
                                   
                                    <div class = "j btn-block m-2 mt-0">
                                        <input id = "single" type= "radio" name="trip" value="single" checked> Single &nbsp &nbsp &nbsp &nbsp
                                        <input id = "return" type= "radio" name="trip" value="return"> Return 
                                        <div class = "row">
                                            <div class = "col-6 planner">{{ form.departTime }}</div>
                                            <div class = "col-6 planner">{{ form.departDate }}</div>
                                        </div>

                                        <div class = "row mt-1">
                                            <div class = "col-6 planner">{{ form.returnTime }}</div>
                                            <div class = "col-6 planner">{{ form.returnDate }}</div>
                                        </div>
                                    </div>
                                    
                                    
                                        <script>
                                            var d = new Date();
                                            var fullDate = String(d.getMonth() + 1) + "/" + String(d.getDate()) + "/" + String(d.getFullYear());
                                            document.getElementById("id_departDate").value = fullDate;
                                            $('#id_departTime').timepicker({ 'forceRoundTime': true, 'scrollDefault': 'now', timeFormat: "H:i" });
                                            $( function() {
                                            $( "#id_departDate" ).datepicker();
                                            });
                                            $('#id_returnTime').timepicker({ 'forceRoundTime': true, 'scrollDefault': 'now',timeFormat: "H:i" });
                                            $( function() {
                                            $( "#id_returnDate" ).datepicker({});
                                            });
                                        </script>
                                    
                                </div>   
                                <div class = "row">
                                    <button type ="button" class = "btn btn-block btn-primary m-2" name = "go" onclick="generateQuery(); showRoute();">GO!</button>
                                    <script>
                                        function generateQuery() {
                                            //this function gets real time information for the stop that is selected.
                                            var jqxhr = $.getJSON(
                                                'https://data.smartdublin.ie/cgi-bin/rtpi/realtimebusinformation?stopid=' +
                                                document.getElementById("id_source").value + '&format=json',
                                                function (daily) {
                                                    console.log("TRying to find realtime")
                                                    console.log(daily);
                                                    var table = "";
                                                           table = "<table>";
                                                           table += "<td>Route</td>";
                                                           table += "<td>Destination</td>";
                                                           table += "<td>Arrival Time</td>";
                                                           x = daily.results;
                                                           for (var i = 0; i < x.length; i++) {
                                                               table += "<tr>";
                                                               table += "<td>" + x[i].route + "</td>";
                                                               table += "<td>" + x[i].destination + "</td>";
                                                               table += "<td>" + x[i].arrivaldatetime + "</td>";
                                                               table += "</tr>";
                                                               table += "</table>";
                                                               document.getElementById("table").innerHTML =
                                                                   table;
                                                           }
                                                })
                                            };
                                    </script>
                                </div>
                            </form>
                            
                        </div>
                    </div>
                    <!-- <div class="col-sm-12 shadow rounded mt-4" style="background-color:rgb(105,143,123);padding:2px;">
                        <div class = "container-fluid mt-2 mb-1">
                            <h1 style = "text-align:center;font-size:23px;" class = "text-white">Dublin, {{ weather.day }} {{ weather.date }} {{ weather.month }}</h1>
                        </div>
                        <div class = "container-fluid ">
                            <div class = "row" style = "color:white;font-size: 14px;">
                                <div class = "col-sm-5">
                                    <div id = "icon"><img src = {{weather.icon}}></div>
                                </div>
                                <div class = "col-sm-7" style = "padding:0px;">
                                    <b>Weather: </b>{{weather.main}} <br>
                                    <b>Temp: </b>{{weather.temp}} °C<br>
                                    <b>Wind: </b>{{weather.wind}} km/h<br>
                                    <b>Max: </b>{{weather.temp_max}} °C<br>
                                </div>
                            </div>

                            <div class="container-fluid rounded pt-1 pb-1" style = "background-color:white;margin:5px;">
                                <div class = "flex-column">
                                    <ul class="nav flex-column">
                                        <li class="nav-item border-bottom border-black">
                                            <a class="nav-link rounded" href="index.html">News <span style = "float:right;color:black">&#8674</span></a>
                                        </li>
                                        <li class="nav-item border-bottom border-black">
                                            <a class="nav-link rounded" href="stops.html">Stops <span style = "float: right;color:black">&#8674</span></a>
                                        </li>
                                        <li class="nav-item border-bottom border-black">
                                            <a class="nav-link rounded" href="#">Routes<span style = "float: right;color:black">&#8674</span></a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link rounded" href="#">Weekly Weather<span style = "float: right;color:black">&#8674</span></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>





            <div class="row" style = "margin-top:20px;" id = "routeResult">
                <div class = "col-sm-12">
                    <div class="col-sm-12 rounded shadow" style = "background-color:rgb(105,143,123);">
                        <div class = "display-4 mb-3 border-bottom border-black text-white">{{ weather.day }} {{ weather.date }} {{ weather.month }}</div>
                        

                        <div class = "row" style = "color:white;font-size: 14px;">
                            <div class = "col-sm-2" style = "background-color:blue;">
                                <div id = "icon"><img src = {{weather.icon}} ></div>
                            </div>
                            <div class = "col-sm-2" style = "padding:0px;background-color:blue;">
                                <b>Weather: </b>{{weather.main}} <br>
                                <b>Temp: </b>{{weather.temp}} °C<br>
                                <b>Wind: </b>{{weather.wind}} km/h<br>
                                <b>Max: </b>{{weather.temp_max}} °C<br>
                            </div>
                            
                        </div>
                        <div><table id = "table"></table></div>
                        <!-- <div class = "row">
                            <div class = "col-sm-3">
                                <div class = "col-sm-12 rounded shadow mb-3" style = "background-color:white;">
                                    <h1 class = "display-4">{{ depart_time }}</h1>
                                    <h2 class = "ml-2 font-weight-bold text-uppercase">UCD</h2>
                                    <h2 class = "ml-2">Stop {{source}}</h2>
                                    <br>
                                </div>
                            </div>
                            <div class = "col-sm-6 text-center">
                                <strong>---------</strong>
                                <img class="animated bounce infinite" src = "{% static 'images/dbuscartoon.png' %}">
                                <strong>---------</strong>
                                <h4 class = "ml-2 mt-2 text-white">Travel Time {{ est }} mins</h4>
                            </div>
                            <div class = "col-sm-3">
                                <div class = "col-sm-12 rounded shadow" style = "background-color:white;">
                                    <h1 class = "display-4">{{ arrival_time }}</h1>
                                    <h2 class = "ml-2 font-weight-bold text-uppercase">Delhurst</h2>
                                    <h2 class = "ml-2">Stop {{ destination }}</h2>
                                    <br>
                                </div>
                            </div>
                        </div> -->


                    </div>
                </div>
            </div>

        
        </div>
        <!-- <div class="container-fluid footer">
            <div class = "row">
                <div class = "col-sm-2"></div>
                <div class = "col-sm-6">
                    <div class = "row">
                        <div class = "col-sm-7">   
                        Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile-first projects on the web.
                        </div>
                        <div class = "col-sm-5">   
                            Made by Mark-Kate Tyrell, Sean Behan, Xinyue Wang & Stephen Colfer
                        </div>
                    </div>
                </div>  
                <div class = "col-sm-3"></div>
            </div>
            <div style = "width:100%;background-color:blue;">
                Made by Mark-Kate Tyrell, Sean Behan, Xinyue Wang & Stephen Colfer
            </div>
        </div> -->



        <div class = "container-fluid">
            <!-- <form method="POST">
                {% csrf_token %}
                {{form.source}}
                {{form.as_p}}
                <button type="submit">Submit</button>
                <h1>{{text1}}</h1>
                <h2>{{text2}}</h2>
            </form> -->
        </div>

        <script>
        //Autcomplete stops code
        $(function() {
            $("#id_source").autocomplete({
                source: "api/getSource/", 
                select: function (event, ui) { //item selected
                AutoCompleteSelectHandler(event, ui)
              },
              minLength: 1,
            });
          });
         
          function AutoCompleteSelectHandler(event, ui)
          {
            var selectedObj = ui.item;
          }</script>
    </body>
    
</html>