{%extends 'base.html' %}
{% load staticfiles %}

{% block body %}
<body>
    <!-- Link to main javaScript file -->
    <script src="{% static 'script/dbus.js' %}"></script>
    <!-- Google Map js link -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_TopsrUXWcqAxGDfmmbpJzAbZWyVx_s0&libraries=places&callback=myMap"
        async defer></script>
    <script src="{% static 'script/jquery.timepicker.min.js' %}"></script>


    <div id="homeCenter" class="container">
        <div class="row">
            <div class="col-sm-8">
                <div class="col-sm-12 shadow rounded mt-4" style="background-color:rgb(105,143,123);padding:3px;">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col nav2 border border-white border-top-0 border-left-0 border-bottom-0">
                                <a class="nav-link" id="trafficButton" onclick="toggleTraffic(this)" href="#">Traffic</a>
                            </div>
                            <div class="col nav2 border border-white border-top-0 border-left-0 border-bottom-0">
                                <a class="nav-link" href="#" onclick="displayBusMarkers()" id="markersbutton">Markers</a>
                            </div>
                            <div class="col nav2">
                                <a class="nav-link" href="#" onclick="displayBikeMarkers()" id="bikesbutton">Bikes</a>
                            </div>
                        </div>

                    </div>

                    <div id="map"></div>


                </div>

                <div id="directionsPanel" style="float:right"></div>

            </div>

            <div class="col-sm-4">
                <div class = "col-sm-12">
                    <div class="col-sm-12 rounded shadow mt-4" style = "background-color:rgb(105,143,123);">
                        <h3>Route Planner</h3>
                    </div>
                </div>

                <div class = "col-sm-12">
                    <div class="col-sm-12 rounded shadow mt-3" style = "background-color:rgb(105,143,123);">
                        <div class = "row text-center text-white">
                            <div class = "col-6 nav-justified" style = "background-color: rgb(105,143,123)" id = "stopSearch" onclick="swapSearch()">
                                <strong>By Stop</strong>
                            </div>
                            <div class = "col-6 text-center" style = "background-color: black;" id = "addSearch" onclick="swapSearch()">
                                <strong>By Address</strong>
                            </div>
                        </div>
                        <form id = "routePlanner" role = "form" method="POST">
                            {% csrf_token %}
                            <div class = "row mt-2">
                                
                                <div class = "j btn-block ml-2 mr-2">From: {{ form.source }}
                                <!-- <a onclick = "swapDirection()">&#8645</a> --></div>
                                <div class = "j btn-block ml-2 mr-2">To: &nbsp &nbsp  {{ form.destination }}</div>
                               
                                <div class = "j btn-block m-2 mt-0">
                                    <input id = "single" type= "radio" name="trip" value="single" checked> Single &nbsp &nbsp &nbsp &nbsp
                                    <input id = "return" type= "radio" name="trip" value="return"> Return 
                                    <div class = "row">
                                        <div class = "col-6 planner">{{ form.departTime }}</div>
                                        <div class = "col-6 planner">{{ form.departDate }}</div>
                                    </div>

                                    <div class = "row mt-1">
                                        <div class = "col-6 planner">{{ form.returnTime }}</div>
                                        <div class = "col-6 planner">{{ form.returnDate }}</div>
                                    </div>
                                </div>
                                
                                
                                    <script>
                                        var d = new Date();
                                        var fullDate = String(d.getMonth() + 1) + "/" + String(d.getDate()) + "/" + String(d.getFullYear());
                                        document.getElementById("id_departDate").value = fullDate;
                                        $('#id_departTime').timepicker({ 'forceRoundTime': true, 'scrollDefault': 'now', timeFormat: "H:i" });
                                        $( function() {
                                        $( "#id_departDate" ).datepicker();
                                        });
                                        $('#id_returnTime').timepicker({ 'forceRoundTime': true, 'scrollDefault': 'now',timeFormat: "H:i" });
                                        $( function() {
                                        $( "#id_returnDate" ).datepicker({});
                                        });
                                    </script>
                                
                            </div>   
                            <div class = "row">
                                <button type ="submit" class = "btn btn-block btn-primary m-2" name = "go" onclick="showRoute();">GO!</button>
                                <script>
                                    function generateQuery() {

                                        //this function gets real time information for the stop that is selected.

                                        var jqxhr = $.getJSON(
                                            'https://data.smartdublin.ie/cgi-bin/rtpi/realtimebusinformation?stopid=' +
                                            document.getElementById("id_source").value + '&format=json',
                                            function (daily) {
                                                console.log("TRying to find realtime")
                                                console.log(daily);
                                                var table = "";
                                                       table = "<table>";
                                                       table += "<td>Route</td>";
                                                       table += "<td>Destination</td>";
                                                       table += "<td>Arrival Time</td>";
                                                       x = daily.results;
                                                       for (var i = 0; i < x.length; i++) {

                                                           table += "<tr>";
                                                           table += "<td>" + x[i].route + "</td>";
                                                           table += "<td>" + x[i].destination + "</td>";
                                                           table += "<td>" + x[i].arrivaldatetime + "</td>";
                                                           table += "</tr>";

                                                           table += "</table>";
                                                           document.getElementById("table").innerHTML =
                                                               table;
                                                       }
                                            })
                                        };
                                </script>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </div>


        <div class="container">

			<script>

                var d = new Date();
                var fullDate = String(d.getMonth() + 1) + "/" + String(d.getDate()) + "/" +
                    String(d.getFullYear());
                document.getElementById("id_departDate").value = fullDate;
                $('#id_departTime').timepicker({
                    'forceRoundTime': true,
                    'scrollDefault': 'now',
                    timeFormat: "H:i"
                });
                $(function () {
                    $("#id_departDate").datepicker();
                });
                $('#id_returnTime').timepicker({
                    'forceRoundTime': true,
                    'scrollDefault': 'now',
                    timeFormat: "H:i"
                });
                $(function () {
                    $("#id_returnDate").datepicker({});
                });
            </script>

            <div class="row" style="margin-top:20px;">
                <div class="col-sm-12">
                    <div class="col-sm-12 rounded shadow" style="background-color:rgb(105,143,123);">
                        <div class="display-4 mb-3 border-bottom border-black">Tuesday 10 July</div>

                        <div class="row">
                            <div class="col-sm-3">
                                <div class="col-sm-12 rounded shadow mb-3" style="background-color:white;">
                                    <h1 class="display-4">{{ depart_time }}</h1>
                                    <h2 class="ml-2 font-weight-bold text-uppercase">UCD</h2>
                                    <h2 class="ml-2">Stop {{ source }}</h2>
                                    <br>
                                </div>
                            </div>
                            <div class="col-sm-6 text-center">
                                <strong>---------</strong>
                                <img class="animated bounce infinite" src="{% static 'images/dbuscartoon.png' %}">
                                <strong>---------</strong>
                                <h4 class="ml-2 mt-2 text-white">Travel Time {{ est }} mins</h4>
                            </div>
                            <div class="col-sm-3">
                                <div class="col-sm-12 rounded shadow" style="background-color:white;">
                                    <h1 class="display-4">{{ arrival_time }}</h1>
                                    <h2 class="ml-2 font-weight-bold text-uppercase">Delhurst</h2>
                                    <h2 class="ml-2">Stop {{ destination }}</h2>
                                    <br>
                                </div>
                            </div>
                        </div>
                        <div class = "row mb-2">
                            <div class = "col-sm-4">
                                <button class = "btn btn-block btn-success" onclick = "getValue();">Walk Me</button>
                            </div>
                            <div class = "col-sm-4">
                                <button class = "btn btn-block btn-danger" onclick="generateQuery()">Real-time</button>
                            </div>
                            <div class = "col-sm-4">
                                <button class = "btn btn-block btn-warning text-white">Timetable</button>
                            </div>
                        </div>
                        <div><table id = "table"></table></div>
                    </div>
                    <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo">Dont Know Stop?</button>
            		<div id="demo" class="collapse">
                		<div class="pac-card" id="pac-card">

                    		<div id="pac-container">
                       			<br>
		                        <h6>You can use the below search option to zoom in on a specific area on the map</h6>
		                        <br>
		                        <h6>Once the map has zoomed to that area, you can choose to toggle the markers to show the stops</h6>
		                        <br>

                        		<div>
                           			<input id="genSearch" placeholder="Search General Area" type="text"></input>
                        		</div>
                    		</div>
               			</div>
            		</div>
                </div>
            </div>
            <table class="table-responsive table-bordered table-striped overflow-y: hidden" id="table">
            </table>

    
        </div>
    
    </body>
{% endblock %}
